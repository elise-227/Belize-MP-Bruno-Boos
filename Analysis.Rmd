---
title: "Analysis"
author: "Elise Boos"
date: "2022-10-03"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages etc}
getwd()
#packages
require(tidyverse)
require(dplyr)
require(sf)
require(leaflet)
require(mapview)
require(readxl)
require(lubridate)
require(readxl)

library(unmarked)
library(AICcmodavg)
#make mapview work on a mac
mapviewOptions(fgb = FALSE)

#install flocker
#install.packages("remotes")
#remotes::install_github("jsocolar/flocker")

#remove.packages(c("StanHeaders", "rstan"))
#install.packages("StanHeaders", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
#install.packages("rstan", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))

#library(flocker)

#install.packages("camtrapR")
library(camtrapR)

```

```{r making occupancy dataframe 2015}

camop2015 <- read.csv("camop_2015.csv", stringsAsFactors = TRUE)
data2015 <- read.csv("data2015_final.csv", stringsAsFactors =  TRUE)

camop2015 <- cameraOperation(camop2015, stationCol = "site", setupCol = "Date_Place", retrievalCol = "Last.Record", occasionStartTime = 0 , dateFormat = "%Y-%m-%d", writecsv = FALSE)

detect_hist_2015_grayfox <- detectionHistory(recordTable = data2015, species = "Gray Fox", camOp= camop2015, output = "binary", stationCol = "site", speciesCol = "Species", day1 ="station", recordDateTimeCol = "date_time_obs", recordDateTimeFormat =  "%Y-%m-%d %H.%M", timeZone = "UTC", occasionLength = 1, includeEffort = TRUE, scaleEffort = FALSE, writecsv = FALSE)

detectionhist <- detect_hist_2015_grayfox$detection_history
```

```{r model 2015}
unmarkedFrame <- unmarkedFrameOccu(y = detectionhist, siteCovs = NULL, obsCovs = NULL)
summary(unmarkedFrame)

fm <- occu(formula = ~1
                     ~1,
           data = unmarkedFrame)
summary(fm)

backTransform(fm, type = "state")
backTransform(fm, type = "det")


#covariates <- read_xlsx("Covariates_cams.xlsx")

#cams700 <- covariates[188:263,]

#dataframe_det <- as.data.frame(detectionhist)
#dataframe_det$rn <- row.names(dataframe_det)


#join <- left_join(dataframe_det,cams700, by = c("rn" = "CameraID"))
#cams700_clean <- select(join, 116:215)
```