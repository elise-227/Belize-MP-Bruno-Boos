---
title: "Cleaning_2014_data"
author: "Elise Boos"
date: '2022-08-15'
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load packages etc}
getwd()
#packages
require(tidyverse)
require(dplyr)
require(sf)
require(leaflet)
require(mapview)
require(readxl)
require(lubridate)

library(unmarked)
library(AICcmodavg)
#make mapview work on a mac
mapviewOptions(fgb = FALSE)
```

```{r load data}
#load data
records_2014 <- read.csv("./By_year/2014_Records_Yalbac_data.csv", stringsAsFactors = T)
records_2015 <- read.csv("./By_year/2015_Records_Yalbac_data.csv", stringsAsFactors = T)
records_2016 <- read.csv("./By_year/2016_Records_Yalbac_data.csv", stringsAsFactors = T)
records_2017 <- read.csv("./By_year/2017_Records_Yalbac_data.csv", stringsAsFactors = T)
records_2018 <- read.csv("./By_year/2018_Records_Yalbac_data.csv", stringsAsFactors = T)
records_2019 <- read.csv("./By_year/2019_Records_Yalbac_data.csv", stringsAsFactors = T)
records_2020 <- read.csv("./By_year/2020_Records_Yalbac_data.csv", stringsAsFactors = T)
```


```{r species names}
#figure out what each species name is 
unique(records_2014$Species)
unique(records_2015$Species)
unique(records_2016$species.name)
unique(records_2017$species.name)
unique(records_2018$species.name)
unique(records_2019$species.name)
unique(records_2020$species.name)
```

Ultimately need to make this:

unmarkedMultFrame(y, siteCovs, obsCovs, numPrimary, yearlySiteCovs)

y	- A matrix of the observed data.

siteCovs - Data frame of covariates that vary at the site level.

obsCovs	- Data frame of covariates that vary within site-year-observation level.

numPrimary - Number of primary time periods (seasons in the multiseason model).

yearlySiteCovs - Data frame containing covariates at the site-year level.

```{r 2014 cleaning}
#clean all 2014 data
records_2014_clean <- records_2014 %>%
  mutate(site = paste0(Cam.nr,Series))

unique(records_2014_clean$site)
```
71 cameras have observations for 2014. 79 cameras are listed with 3 not placed or stolen. Allegedly 76 should have been recording so logically 5 sites had 0 observations of any animal

These cameras that observed nothing or didn't work (hypothetically) are 402A, 402C, 406F, 408F and 412C2.

length of all matrices for 2014 then should be 76 because there are than many sites.

```{r days op and ect}
#load operational days
cameraops2014 <- read.csv("./2014/OperationalDays2014_edits.csv", header = T)

#data frame for 2014 
datafor2014 <- full_join(records_2014_clean, cameraops2014, by = "site")

#set as date column
datafor2014$startday <- as.Date(datafor2014$startday, "%Y-%m-%d")
datafor2014$removeday <- as.Date(datafor2014$removeday, "%Y-%m-%d")

#calculate end date
datafor2014_edit <- datafor2014 %>%
  mutate(endday = startday + daysop)
#add one here?

#find visit number
datafor2014_visit <- datafor2014_edit %>%
  mutate(obsdate = as.Date(paste0(Year,"-",Month,"-",Day), "%Y-%m-%d")) %>%
  mutate(visit = as.numeric(obsdate - startday + 1))

#error finder 
datafor2014_errors <- datafor2014_visit %>%
  mutate(errors = ifelse(obsdate > endday, TRUE, FALSE)) 
summary(datafor2014_errors$errors)

#get list of cameras that need op days changed
errorinopdays2014 <- filter(datafor2014_errors, errors == TRUE)

unique(errorinopdays2014$site)
```
Errors in data found that need to fix: 

410C2 is repeated 410C needed to be fixed in the days operational in the original excel file.

Record 2234 is an obs after the camera was removed so need to removed probably. A couple data points are like this need to look into!!!! 241 observations are after end date!
ERROR SEEMS TO BE IN C2 and C points - repeated in data of days operational (more than this tho)

are days operational including day 1? From looking at data day 1 is included as one operational day. Actually idk

Some points that are inconsistent going to need to just put 0s to the days the camera was out there.

39 or more like 47? cameras have incorrect operational days. for 2014 might just have to do the days the camera was out

------------------------------
```{r 2015 cleaning}
#clean all 2014 data
records_2015_clean <- records_2015 %>%
  mutate(site = paste0(Cam.nr,Series)) %>%
  drop_na(Cam.nr)

unique(records_2015_clean$site)
```

```{r joining cams}
cameraops2015 <- read.csv("./2015/Cameras_2015.csv", header = T)

datafor2015 <- full_join(records_2015_clean, cameraops2015, by = c("site" = "Name"))

#set as date 
datafor2015$Date_Place <- as.Date(datafor2015$Date_Place, "%B %d, %Y")
datafor2015$Date_Remov <- as.Date(datafor2015$Date_Remov, "%B %d, %Y")

datafor2015_edit <- datafor2015 %>%
  mutate(endday = Date_Place + Days)
#add one here?

#find visit number
datafor2015_visit <- datafor2015_edit %>%
  mutate(obsdate = as.Date(paste0(Year,"-",Month,"-",Day), "%Y-%m-%d")) %>%
  mutate(visit = as.numeric((obsdate - Date_Place) + 1))

#error finder 
datafor2015_errors <- datafor2015_visit %>%
  mutate(errors = ifelse(obsdate > endday, TRUE, FALSE)) 
summary(datafor2015_errors$errors)
#507H has typo 2016 instead of 2015 

datafor2015_errorsfixed <- datafor2015_errors %>%
  mutate(year_clean = ifelse(site == "507H" & errors == TRUE, paste(2015), Year))

#redo visit and errors 
datafor2015_visit <- datafor2015_errorsfixed %>%
  mutate(obsdate = as.Date(paste0(year_clean,"-",Month,"-",Day), "%Y-%m-%d")) %>%
  mutate(visit = as.numeric((obsdate - Date_Place) + 1))

datafor2015_errors <- datafor2015_visit %>%
  mutate(errors = ifelse(obsdate > endday, TRUE, FALSE)) 
summary(datafor2015_errors$errors)

unique(errorinopdays2014$site)
```

Only errors in 7 of the observations - can check back for typos 